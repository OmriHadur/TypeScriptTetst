{
	"create": {
		"input": {
			"addressId": "validId"
		},
		"variables": {
			"address": "getById(addresses,input.addressId)",
			"cart": "findOne(carts,{userId:user.id})"
		},
		"validations": {
			"addressNotExist": "variables.address",
			"addressNotOwned": "variables.address?.userId == user.id || user.isAdmin",
			"cartNotExist": "variables.cart",
			"cartHasNoItems": "variables.cart?.itemsCount > 0"
		},
		"entity": {
			"userId": {
				"type": "string",
				"isUniqe": true,
				"value": "user.id"
			},
			"cart": {	
				"type": "carts",
				"isUniqe": true,
				"value": "findOne(carts,{userId:user.id})"
			},
			"createdAt": {
				"type": "date",
				"value": "now()"
			}
		},
		"post": {
			"cleanCart": "deleteById(carts,variables.cart._id)"
		}
	},
	"alter": {
		"entity": {
			"alteredAt": {
				"type": "date",
				"value": "now()"
			}
		}
	},
	"resource": {
		"id": "input._id",
		"cart": true,
		"createdAt": true,
		"alteredAt": true
	}
}
